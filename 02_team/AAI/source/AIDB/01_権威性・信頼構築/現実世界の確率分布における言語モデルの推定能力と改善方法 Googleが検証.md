---
title: "現実世界の確率分布における言語モデルの推定能力と改善方法 Googleが検証"
source: "https://ai-data-base.com/archives/71357"
author:
  - "[[AIDB Research]]"
published: 2024-06-20
created: 2025-06-13
description: "LLMが確率分布を理解し、確率推定を行う能力については、まだ十分に研究されていません。本記事では、現実世界の分布に対するLLMの推論能力を評価し改善につながる方法を模索したGoogleの研究を取り上げます。"
tags:
  - "clippings"
---
**【お知らせ】** AIDB主催のビジネスマッチングイベントを7月25日(金)開催予定です！  
  

\---以下、記事本文---

LLMが確率分布を理解し、確率推定を行う能力については、まだ十分に研究されていません。本記事では、現実世界の分布に対するLLMの推論能力を評価し改善につながる方法を模索したGoogleの研究を取り上げます。

![](https://ai-data-base.com/wp-content/uploads/2024/06/AIDB_71357-2-1024x576.jpg)

**参照論文情報**

- タイトル：What Are the Odds? Language Models Are Capable of Probabilistic Reasoning
- 著者：Akshay Paruchuri, Jake Garrison, Shun Liao, John Hernandez, Jacob Sunshine, Tim Althoff, Xin Liu, Daniel McDuff
- 所属：Google

## 背景

LLMが数値を扱う推論能力、特に確率分布の理解については、まだ十分に評価されていません。

確率分布とは、あるデータが全体としてどのようなばらつきを持っているかを示すもので、個々のデータを評価する上で大変重要です。例えば、ある人が1日に8時間睡眠をとることが一般的かどうかを判断するには、母集団全体の睡眠時間の分布を把握する必要があります。あるいは、気候変動の研究では、ある日の最高気温が、過去のデータと比較してどの程度珍しいのかを判断するために、気温の分布を理解することが不可欠です。

LLMは数値を扱う推論が苦手とされており、その原因としては、学習方法や数値の表現方法が数学的な推論に適していないことなどが考えられます。

一方で、LLMに例題を与えるなどの工夫をすることで、数値タスクの性能を大幅に向上できる可能性も示唆されています。  
そこで今回研究者らは、LLMが確率分布をどの程度理解できるのかを、様々な種類の分布を使って検証しました。

さらに、現実世界における様々なデータ（例えば、歩数、所得、気温など）の分布についても、LLMがどの程度理解できるかを検証しました。

この研究は、人間の認知メカニズムに関する研究成果にも触発されているとのことです。人間は複雑な確率分布を理解できますが、平均や分散といった統計量を認識する際にはバイアスがかかることが知られています。人間の認知に関する知見は、LLMの確率的推論能力を向上させるためのヒントになるかもしれません。

![](https://ai-data-base.com/wp-content/uploads/2024/06/AIDB_71357_4-492x1024.jpg)

LMは分布に関する推論を行うことができ、実世界のコンテキスト、例示、単純化された仮定を取り入れることでさらに助けられる。たとえそれらの仮定が不正確であったり誤って特定されていたりしても。

## 確率的推論タスクの定義

この研究では、LLMが基礎的な確率分布をどの程度理解しているかを調べるために、3つのタスクが考案されました。

### 1\. パーセンタイルの推定

ある分布において、特定の値が上位から何パーセント目に位置するかを推定するタスクです。例えば、「平均100、標準偏差10の正規分布において、値115は何パーセンタイルに位置するか？」といった質問が出されます。LLMは0から100までの数値で回答することが期待されます。

**パーセンタイルの例**

![](https://ai-data-base.com/wp-content/uploads/2024/06/AIDB_71357_1-1024x419.png)

```js
## You are an expert on statistics. Your task is to estimate the percentile of a number within a specific distribution.
Answer with just a numerical response from 0 to 100. Make sure your final answer is enclosed by xml tags <answer> and </answer>.

## Here are some examples to help you understand the task:

{few_shot_examples}

## Consider the following distribution:
{distribution_description}

## Here is your question:
Question:

What is the percentile of the value {target_number} within the provided distribution?
Answer:
```

日本語版

```js
## あなたは統計の専門家です。特定の分布における数値のパーセンタイルを推定してください。
回答は0から100までの数値のみで、最終的な回答はXMLタグ<answer>と</answer>で囲んでください。

## 課題を理解するために、いくつかの例を以下に示します：

{few_shot_examples}

## 次の分布について考えてください：
{distribution_description}

## 質問です：
質問：

与えられた分布において、値{target_number}は何パーセンタイルに位置しますか？
回答：
```

### 2\. サンプルの抽出

与えられた分布からランダムに数値を生成するタスクです。例えば、「平均50、標準偏差5の正規分布から数値を1つ生成する」といった指示が出されます。LLMは、プログラミングや外部ツールを使わずに、数値のみを回答することが求められます。

**[サンプリング](https://ai-data-base.com/archives/26518 "サンプリング") の例**

![](https://ai-data-base.com/wp-content/uploads/2024/06/AIDB_71357_2-1024x357.png)

```js
## You are an expert on statistics. Your task is to sample a number from a given distribution. Do not write any code or use any additional tools to perform the sampling. Answer with just a numerical response. Make sure your final answer is enclosed by xml tags <answer> and </answer>.

## Here are some examples to help you understand the task:

{few_shot_examples}

## Consider the following distribution:
{distribution_description}

## Instruction: Sample a number from the given distribution and output only the numerical value.
```

日本語版

```js
## あなたは統計の専門家です。与えられた分布から数値をサンプリングしてください。サンプリングを実行するためにコードを書いたり、追加のツールを使用したりしないでください。数値のみで回答してください。最終的な回答はXMLタグ<answer>と</answer>で囲んでください。

## 課題を理解するために、いくつかの例を以下に示します

{few_shot_examples}

## 次の分布について考えてください：
{distribution_description}

## 指示：与えられた分布から数値をサンプリングし、数値のみを出力してください。
```

### 3\. 確率の計算

与えられた分布において、ある範囲内の値が出現する確率を計算するタスクです。例えば、「平均0、標準偏差1の標準正規分布において、-1.96から1.96の間の値が出現する確率はいくつか？」といった質問が出されます。LLMは0から1までの数値で確率を回答することが期待されます。

**確率計算の例**

![](https://ai-data-base.com/wp-content/uploads/2024/06/AIDB_71357_3-1024x446.png)

```js
## You are an expert on statistics. Your task is to estimate the probability of being in a range of values within a given distribution. Answer with just a numerical response from 0 to 1, representing the probability. Make sure your final answer is enclosed by xml tags <answer> and </answer>.

## Here are some examples to help you understand the task:

{few_shot_examples}

## Consider the following distribution:
{distribution_description}

## Here is your question:
Question:

Considering only values including and between the 1st percentile and the 99th percentile, what is the probability that a value from the provided distribution is between {lower_target_number} and {upper_target_number}?

Answer:
```

日本語版

```js
## あなたは統計の専門家です。与えられた分布において、ある範囲内の値が出現する確率を推定してください。確率を表す0から1までの数値のみで回答してください。最終的な回答はXMLタグ<answer>と</answer>で囲んでください。

## 課題を理解するために、いくつかの例を以下に示します：

{few_shot_examples}

## 次の分布について考えてください：
{distribution_description}

## 質問です：
質問：

1パーセンタイルと99パーセンタイルを含む、その間の値のみを考慮すると、与えられた分布からの値が{lower_target_number}と{upper_target_number}の間にある確率はどれくらいですか？

回答：
```

### 現実世界のコンテキストの影響

現実世界におけるデータの分布は、理想化された分布よりも複雑です。例えば、ある国の所得分布は正規分布ではなく、特定の形状を持つことがあります。そこで今回の研究では、現実世界のデータ（例えば、健康、金融、気候に関するデータ）の分布に対してLLMがどの程度対応できるかが検証されました。

中でも「パーセンタイルの推定」タスクにおいては、現実世界のデータの分布に関する情報（例えば、データの出典や収集年など）をLLMに与えることで、推定精度が向上するかどうかが検証されました。

## 実験に使用されたデータセット

2種類のデータセットが用いられました。

### 理想化された分布

正規分布や指数分布など、統計学でよく知られている12種類の分布が使われました。LLMには、それぞれの分布の特徴を表すパラメータ（例えば、正規分布の場合は平均と標準偏差）が与えられます。ただし、確率密度関数や累積分布関数といった、分布のより詳細な情報は与えられません。

### 現実世界の分布

健康、金融、気候という3つの分野から収集された現実のデータの分布です。

**健康**  
18歳から65歳までのアメリカ人の Fitbit ユーザー10万人から、歩数、安静時心拍数、睡眠時間、運動時間といったデータが収集されました。

**金融**  
アメリカ国勢調査局のデータから、2018年のアメリカにおける個人の年収、世帯の月額家賃、年間の電気代、水道代といったデータが収集されました。

**気候**  
アメリカ海洋大気庁のデータから、2018年のアメリカにおける日平均気温、降水量、風速、湿度といったデータが収集されました。

![](https://ai-data-base.com/wp-content/uploads/2024/06/AIDB_71357_5-1024x638.jpg)

評価に用いた12の理想化された分布と12の現実世界の分布（健康、金融、気候の分野）の可視化

## 実験設定

### 理想化された分布

**ゼロショットパフォーマンス**

まず、確率分布に関する質問にLLMがどの程度答えられるかが、事前に例題を与えられない状態（ゼロショット）で検証されました。Gemini 1.0 Ultra、GPT4-Turbo、GPT3.5-Turbo、Llama3-70Bの4つのLLMにより、12種類の理想化された分布に対して3つのタスク（パーセンタイルの推定、サンプルの抽出、確率の計算）が実行されました。

**N-ショットパフォーマンス**

次に、LLMにいくつかの例題が与えられた場合（N-ショット）に、そのパフォーマンスがどのように変化するかが検証されました。

2種類の例題の与え方が検討されました。  
1つ目は、質問の対象となる分布と同じ種類の分布から例題が与えられる方法（分布ファミリー内分布ショット）です。例えば、正規分布に関する質問であれば、平均や標準偏差が異なる別の正規分布が例題として与えられます。  
2つ目は、質問の対象となる分布と全く同じ分布から例題が与えられる方法（分布内ショット）です。

**ベースラインとの比較**

パーセンタイルの推定タスクでは、上記2つの方法に加えて、単純な方法（ベースライン）との比較も行われました。このベースラインは、与えられた例題の中から、質問の値に最も近い例題のパーセンタイルがそのまま回答として返されるというものです。LLMの性能がベースラインを上回る場合、LLMは単に例題を暗記しているのではなく、分布を理解して推論していると考えられます。

### 現実世界の分布

**ゼロショットパフォーマンス**

現実世界のデータ（健康、金融、気候に関するデータ）の分布に対してLLMがどの程度対応できるかが検証されました。各データの出典や収集年などの情報がLLMに与えられ、パーセンタイルの推定タスクが実行されました。

**コンテキストによるパフォーマンス**

現実世界のデータの分布に関する情報（コンテキスト）が与えられることによるLLMの性能の影響が検証されました。同じ分布に対して、コンテキストを与えた場合と与えない場合の性能が比較されました。

**単純化された仮定**

現実世界のデータの分布が複雑な形状をしていることが多いですが、全ての分布を正規分布と仮定してLLMに質問が与えられるという方法が試されました。正規分布が多くの現象を近似できるという性質を利用したものです。

![](https://ai-data-base.com/wp-content/uploads/2024/06/AIDB_71357_6-1024x836.jpg)

5つの一般的な分布に対するLMの結果（上）パーセンタイルの推定、（中）サンプルの抽出、（下）確率の推定。

## 実験結果

### 理想化された分布

**（１）LLMは、例題なしで理想化された分布に関する質問に正確に答えられるか？**

→分布の種類によって異なる。

LLMの性能は分布の種類によって大きく異なり、一様分布と正規分布で最も良い結果となりました。また、タスクの種類によっても性能が異なり、パーセンタイルの推定は比較的良好でしたが、確率の計算やサンプルの抽出は苦手な傾向が見られました。しかし、例題がいくつか与えられることで、すべてのタスクにおいて性能が大幅に向上しました。

**（２）同じ種類の分布から異なる例題を与えるのと、同じ分布からサンプルを与えるのとでは、どちらが役に立つか？**

→同じ分布からサンプルを与える方が効果的。

同じ分布からサンプルを与える方が、同じ種類の分布から異なる例題を与えるよりも、LLMの性能向上に効果的であることが示されました。

**（３）LLMは、与えられた例題の中で最も近い値をそのまま回答として返しているだけなのか？**

→例題の間を補間して推論している。

LLMは単に例題をコピーしているだけではなく、例題の間を補間して推論を行っていると考えられます。LLMの性能は、最も近い例題の値をそのまま返すだけの方法よりも優れていることが観察されました。

**（４）LLMは、現実世界の分布について、例題なしでどの程度正確に推論できるか？**

→分布の種類によって異なる。

LLMの種類によって得意分野に違いがあり、Gemini 1.0 Ultraは気候関連の分布で、GPT4-Turboは健康関連の分布で優れた性能を示しました。また、この2つのLLMは金融関連の分布でも同程度の性能を発揮し、他のLLMよりも優れていました。これらの性能の違いは、LLMが学習した大量のデータの内容の違いに起因すると考えられます。

**（５）LLMに現実世界の分布に関する情報を与えることは、推論の性能向上に役立つか？**

→役立つ。

平均的に見ると、現実世界の分布に関する情報をLLMに与えることで性能が向上し、さらに正規分布に近似するという情報を加えることでより性能が向上しました。ただし、この傾向はすべての分布に当てはまるわけではなく、もともとある程度の性能がある分布に限られているようです。

**（６）正規分布に近似するという単純な仮定を用いることは、LLMの推論性能を向上させるのに効果的か？**

→平均的には、どの分野の分布でも効果的。

現実世界の分布が理想的な正規分布とは異なることが多いにもかかわらず、正規分布に近似するという単純な仮定を用いることで、現実世界の分布に対するLLMの推論性能が一貫して向上しました。LLMが不完全な情報で学習されていても、正規分布という有用なモデルを適用することで性能が向上するのは興味深い結果です。

**（７）正規分布に近似するという単純な仮定と、例題をいくつか与えるのとでは、どちらがLLMの性能向上に効果的か？**

→一般的には、例題をいくつか与える方が効果的。

健康、金融、気候という様々な分野のデータセットにおいて、正規分布に近似するよりも、例題をいくつか与える方が優れた性能を発揮することが分かりました。

## まとめ

本研究では、確率分布をどの程度理解できるかがLLMによって検証されました。実験の結果、正規分布や一様分布といった比較的単純な分布については、ある程度の推論能力がLLMによって示されました。しかし、より複雑な分布については、まだ改善の余地があることが明らかになりました。

また、現実世界のデータの分布に対しても、適切な情報が追加されることで、ある程度の推論能力がLLMによって発揮されることが示されました。さらに、正規分布を仮定するなどの単純化が行われることで、LLMの推論能力を向上させる可能性も示唆されました。

LLMの確率的推論能力が向上すれば、様々な分野でのLLMの活用が期待されます。さらに検証が進むといいですね。

- 参照論文URL： [https://arxiv.org/abs/2406.12830](https://arxiv.org/abs/2406.12830)

**■サポートのお願い  
**AIDBを便利だと思っていただけた方に、任意の金額でサポートしていただけますと幸いです。  

  

[『プロンプトレポート』OpenAIなどが作成した調査報告書　〜その3　プロンプトエンジニアリングのケーススタディ〜](https://ai-data-base.com/archives/71186)

[オープンソースモデルでも力を合わせれば先端モデルに匹敵することを示す「Mixture-of-Agents（MoA）」アーキテクチャ](https://ai-data-base.com/archives/71419)

 [![](https://ai-data-base.com/wp-content/themes/innovate_hack_tcd025/img/footer/return_top.png) PAGE TOP](https://ai-data-base.com/archives/#header_top)