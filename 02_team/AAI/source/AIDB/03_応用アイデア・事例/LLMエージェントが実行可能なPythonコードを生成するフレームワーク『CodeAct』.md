---
title: "LLMエージェントが実行可能なPythonコードを生成するフレームワーク『CodeAct』"
source: "https://ai-data-base.com/archives/68926"
author:
  - "[[AIDB Research]]"
published: 2024-05-13
created: 2025-06-13
description: "通常のLLMエージェントは、テキストやJSONを用いてAPIツールを操作していますが、柔軟性に欠ける（タスクに制限があるなど）といった課題があります。"
tags:
  - "clippings"
---
**【お知らせ】** AIDB主催のビジネスマッチングイベントを7月25日(金)開催予定です！  
  

\---以下、記事本文---

通常のLLMエージェントは、テキストやJSONを用いてAPIツールを操作していますが、柔軟性に欠ける（タスクに制限があるなど）といった課題があります。そこで研究者らは、LLMエージェントが自身のアクションプランに合わせたPythonコードを生成するフレームワーク「CodeAct」を提案しています。コードの実行結果に基づいて動的に行動を修正したり、新たな行動を生成したりすることができます。

![](https://ai-data-base.com/wp-content/uploads/2024/05/AIDB_68926-1024x576.jpg)

**参照論文情報**

- タイトル：Executable Code Actions Elicit Better LLM Agents
- 著者：Xingyao Wang, Yangyi Chen, Lifan Yuan, Yizhe Zhang, Yunzhu Li, Hao Peng, Heng Ji
- 所属：University of Illinois Urbana-Champaign, Apple

**本記事の関連研究** ：

- [プロンプトでLLMにRPAワークフローを自動生成させる手法「FlowMind」JPモルガン考案](https://ai-data-base.com/archives/68095)
- [「人間の自然言語を超えて」LLMにタスク実行時の思考を非自然言語フォーマットで行わせるプロンプト手法『AutoForm（オートフォーム）』](https://ai-data-base.com/archives/65090)
- [マインクラフトを上手にプレイするAI『JARVIS-1』登場](https://ai-data-base.com/archives/59670)
- [多様な役割のAIエージェント達に協力してソフトウェアを開発してもらう『ChatDev』登場。論文内容＆使い方を解説](https://ai-data-base.com/archives/54863)

## 背景

LLMは単なるテキスト処理を超えて、APIの呼び出しやロボット制御など、より実世界に近いタスクにも適用できるようになってきました。LLMをベースとしたエージェント（いわゆるLLMエージェント）は、ツールの呼び出しやメモリ管理などの機能を備えることで、科学実験の実行といった複雑な現実世界のタスクにも取り組めるようになってきています。

LLMエージェントがツールを使用する際には、通常、テキストやJSONの形式が用いられています。しかし、特定のタスクやツールのみしか使用できないなど、柔軟性に欠けるといった課題があります。一方で、LLMにコードを生成させてロボットやゲームキャラクターを制御する試みもなされてきましたが、事前に定義された制御コードやプロンプトへの依存が大きく、環境からのフィードバックに基づいて動的にアクションを調整・生成することが難しいという問題がありました。

そこで本研究では、PythonコードをLLMエージェントのアクションとして用いるCodeActという枠組みが提案されました。

また、17種類のLLMを用いた詳細な実験により、CodeActの有効性が示されました。単純なツール使用のタスクでは、CodeActはテキストやJSONと同等以上の性能を発揮しました。さらに、複数のツールの連携が必要な複雑なタスクを集めたベンチマークM3ToolEvalでは、CodeActがベースラインに比べて最大20%の精度向上を達成しつつ、必要なアクション数を30%削減できることが確認されました。このパフォーマンスの向上は、LLMの能力が高いほど顕著に表れました。

以下ではフレームワークを詳しく紹介します。

下記は、CodeActとテキスト/JSONをアクションとして使用した場合の比較を示した図です。上が異なるアクションを比較する例で、下がM3ToolEvalにおける定量的な結果です。

![](https://ai-data-base.com/wp-content/uploads/2024/05/AIDB_68926_1-1-1024x434.jpg)

## CodeActの3つの特徴

**（１）事前学習データの利用**

LLMは事前学習の際に大量のコードデータを用いているため、コードに対する理解力が高いことが知られています。そのため、コードに特化したフレームワークを用いることでLLMのコード生成能力を活用します。

**（２）複雑な操作への対応**

複数のツールを組み合わせるような複雑な操作を、1つのコードで表現します。データフローと制御フローをネイティブにサポートします。

**（３）自動フィードバックの活用**

エラーメッセージなどのフィードバック機構は、ほとんどのプログラミング言語にデフォルトで実装されています。LLMにフィードバックを直接活用し、自身のアクションを改善させます。

![](https://ai-data-base.com/wp-content/uploads/2024/05/AIDB_68926_3-1024x235.png)

CodeActを使用した場合とテキスト/JSONを使用した場合のLLMアクションの利点の比較

## フレームワークの時系列実行フロー

1. ユーザーがLLMエージェントに自然言語で指示を与える
2. LLMエージェントが指示を理解し、タスクを実行するためのPythonコードを生成する
3. 生成されたPythonコードがCodeActの枠組みに基づいて実行される
	- 必要に応じて、Pythonインタープリタを通じて既存のライブラリやツールを活用する
	- コードの実行結果や環境からのフィードバックをLLMエージェントが受け取る
4. LLMエージェントが実行結果やフィードバックを分析し、次のアクションを決定する
	- 必要に応じて、前のアクションを動的に調整したり、新たなアクションを生成したりする
	- マルチターンインタラクションを通じて、エージェントが自己改善を行う
5. LLMエージェントが更新されたPythonコードを生成し、再度CodeActの枠組みで実行する（ステップ3へ戻る）
6. タスクが完了するまで、ステップ3〜5を繰り返す
7. タスクが完了したら、LLMエージェントがユーザーに自然言語で結果を報告する
8. ユーザーが結果を確認し、必要に応じてフィードバックをLLMエージェントに与える
9. フィードバックを受け取ったLLMエージェントが、さらなる改善のためにタスクを再実行する（ステップ2へ戻る）
10. ユーザーが満足する結果が得られるまで、ステップ2〜9を繰り返す

![](https://ai-data-base.com/wp-content/uploads/2024/05/AIDB_68926_4-1024x374.jpg)

CodeActを実装した場合の一般的なエージェントのマルチターンインタラクションフレームワークの概念図

## 2つの実験結果

CodeActの有効性を検証するために、2つの実験が行われました。

なお、実験に使用されたLLMを下記に列挙します。

#### オープンソース LLM

1. CodeLlama-7b-Instruct-hf
2. CodeLlama-13b-Instruct-hf
3. CodeLlama-34b-Instruct-hf
4. Llama-2-7b-chat-hf
5. Llama-2-13b-chat-hf
6. Llama-2-70b-chat-hf
7. Mistral-7B-Instruct-v0.1
8. lemur-70b-chat-v1

#### クローズドソース LLM

1. claude-2
2. claude-instant-1
3. gemini-pro
4. gpt-3.5-turbo-0613
5. gpt-3.5-turbo-1106
6. gpt-4-0613
7. gpt-4-1106-preview
8. text-davinci-002
9. text-davinci-003

### 実験1：基本的なツール使用タスクにおける性能比較

研究者らは、まず基本的なツール使用のタスクにおいて、CodeActとテキスト・JSONを比較しました。この実験では、APIの呼び出しを1回だけ行うシンプルなタスクが用いられました。

実験の結果、ほとんどのLLMにおいて、CodeActがテキストやJSONと同等以上の性能を示すことが明らかになりました。この結果は、LLMがコードに対する高い理解力を持っていることを示唆しています。

![](https://ai-data-base.com/wp-content/uploads/2024/05/AIDB_68926_5-934x1024.jpg)

API-BankにおけるAPI呼び出しの正確性の比較。最高のパフォーマンスは太字、次点は下線。

### 実験2：複雑なタスクにおける性能比較

次に、研究者らは複数のツールの連携が必要な複雑なタスクにおいて、CodeActの性能を評価しました。この実験では、M3ToolEvalと呼ばれる新たなベンチマークが用いられました。

M3ToolEvalは、複数のツールを組み合わせて使用する必要があるタスクを集めたもので、以下のようなタスクが含まれています。

1. **ウェブブラウジング**
	- 特定の情報をオンラインで検索し、収集する
	- ウェブサイトのナビゲーションを行い、必要なデータを抽出する
2. **ファイナンス**
	- 株価や為替レートの取得と分析
	- 財務報告書の解析と重要な指標の計算
3. **旅行の旅程計画**
	- 旅行先の選定、宿泊施設の予約、交通手段の調整
	- 旅行スケジュールの最適化と予算管理
4. **科学**
	- 科学実験の設計と結果の分析
	- 複雑なデータセットの処理と視覚化
5. **情報処理**
	- 大規模なデータセットの解析と要約
	- 自然言語での質問応答やテキストの分類

実験の結果、CodeActがテキストやJSONを大きく上回る性能を示すことが明らかになりました。最大で20%の精度向上を達成しつつ、必要なアクション数を30%削減できることが確認されました。

![](https://ai-data-base.com/wp-content/uploads/2024/05/AIDB_68926_6-1024x785.jpg)

M3ToolEvalにおける成功率とインスタンスあたりの平均ターン数。最高の結果は太字、次点は下線。

### 更なる強化

CodeActは、マルチターンインタラクションと既存のソフトウェアパッケージを活用することで、LLMエージェントをさらに強化できることが示唆されています。実際に、Pythonと統合されたCodeActAgentは、データの可視化や機械学習モデルの学習など、高度なタスクを既存のPythonパッケージを用いて実行できることが確認されました。さらに、自動エラーメッセージを活用することで、マルチターンインタラクションを通じて自律的にデバッグを行えることも示されました。

## オープンソースのLLMエージェントをCodeActで強化

### データセットの構築と実験

有望な実験結果を受けて、研究者らは、CodeActを通じて環境と対話し、自然言語を介して人間とコミュニケーションできるオープンソースのLLMエージェントの開発に着手しました。

研究者らはまず、CodeActInstructと呼ばれる指示調整データセットを収集しました。エージェントと環境のインタラクションを含む7,000件のトラジェクトリで構成されています。

CodeActInstructは、エージェント、ユーザー、環境の3つの役割を考慮した一般的なエージェントフレームワークに基づいています。以下の4つの領域におけるエージェントと環境のインタラクションに特に焦点を当てています。

1. 情報検索
2. ソフトウェアパッケージの使用
3. 外部メモリとのやり取り
4. ロボットの制御

データの選択においては、マルチターンインタラクションを通じてエージェントが自己改善する能力を高めることに重点が置かれました。

実験によって、CodeActInstructを一般的な指示調整データと組み合わせることで、エージェントタスクにおけるモデルの性能を向上させつつ、一般的な能力を損なわないことが示されました。

### CodeActAgentの開発

上記のデータセットCodeActInstructを用いて、LLaMA-2とMistral-7Bをファインチューニングすることで、CodeActAgentが開発されました。Pythonインタープリタと緊密に統合されており、既存のライブラリを活用して高度なタスクを実行し、自然言語を介してユーザーとコラボレーションすることができます。

下の図は、Pythonと統合されたLLMエージェントが、既存のソフトウェアを使用して複雑なタスクをマルチターンインタラクションで実行する例です。

![](https://ai-data-base.com/wp-content/uploads/2024/05/AIDB_68926_7-1024x525.jpg)

CodeActAgentは、CodeActを用いたエージェントタスクだけでなく、事前定義された形式のテキストアクションを用いたタスクにおいても、ドメイン外のパフォーマンスを向上させることが確認されています。

## まとめ

本記事では、LLMをベースとした自律エージェントの性能を向上させる新たな枠組み「CodeAct」を提案した研究を紹介しました。実行可能なPythonコードをLLMエージェントのアクションとして用いることで、既存の手法よりも優れた性能を発揮します。複数のツールの連携が必要な複雑なタスクにおいて、その効果が顕著に表れています。

また、研究者らは指示調整データセット「CodeActInstruct」を収集し、オープンソースのLLMエージェント「CodeActAgent」を開発しました。既存のPythonライブラリを活用して高度なタスクを実行できる点が特徴です。なお、記事末尾に記載のURLよりチャットを試すことができます。

本研究で得られた知見はLLMエージェントに、より複雑で実践的なタスクにも対応できるようにするために活用できそうです。また、他のプログラミング言語にも適用可能であることにも注目されます。様々な分野で自律エージェントの活用が進んでいくと期待されます。

- URL： [https://arxiv.org/abs/2402.01030](https://arxiv.org/abs/2402.01030)
- GitHub： [https://github.com/xingyaoww/code-act](https://github.com/xingyaoww/code-act)
- CodeActAgentのデモ： [https://chat.xwang.dev/](https://chat.xwang.dev/)

**■サポートのお願い  
**AIDBを便利だと思っていただけた方に、任意の金額でサポートしていただけますと幸いです。  

  

[Googleが開発した「LLMに長文を高精度で読解させる方法論」と実行プロンプト](https://ai-data-base.com/archives/68821)

[認知症の早期介入にLLMチャットボットが役に立つ　ハーバードなどが検証](https://ai-data-base.com/archives/67581)

 [![](https://ai-data-base.com/wp-content/themes/innovate_hack_tcd025/img/footer/return_top.png) PAGE TOP](https://ai-data-base.com/archives/#header_top)