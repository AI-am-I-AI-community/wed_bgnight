---
title: "計画のステップが増えるほど、LLMは最初の目標を見失っていく傾向がある"
source: "https://ai-data-base.com/archives/77302"
author:
  - "[[AIDB Research]]"
published: 2024-10-22
created: 2025-06-13
description: "本記事では、LLMを活用したエージェントの計画立案能力に関する最新の研究結果を紹介します。"
tags:
  - "clippings"
---
**【お知らせ】** AIDB主催のビジネスマッチングイベントを7月25日(金)開催予定です！  
  

\---以下、記事本文---

本記事では、LLMを活用したエージェントの計画立案能力に関する最新の研究結果を紹介します。人工知能の分野で長年の目標とされてきた”自律的な計画立案能力”について、現状のLLMエージェントがどこまで達成できているのか、そしてなぜ人間レベルの能力にはまだ及ばないのかを探る研究です。

![](https://ai-data-base.com/wp-content/uploads/2024/10/AIDB_77302-1024x576.jpg)

**参照論文情報**

- タイトル：Revealing the Barriers of Language Agents in Planning
- 著者：Jian Xie, Kexun Zhang, Jiangjie Chen, Siyu Yuan, Kai Zhang, Yikai Zhang, Lei Li, Yanghua Xiao
- 所属：Fudan University, Carnegie Mellon University, ByteDance Inc., The Ohio State University

**本記事の関連研究**

- [「o1-preview」は自己評価メカニズムを持つ　計画立案中に自分の行動をチェックして修正](https://ai-data-base.com/archives/77179)
- [OpenAIの新しいモデルo1、従来のLLMと比べて「計画能力」で圧倒的な性能向上](https://ai-data-base.com/archives/76177)
- [LLMの「自己対話」により複雑な問題の解決能力を飛躍的に向上させる手法『Iteration of Thought』](https://ai-data-base.com/archives/76134)
- [リアルなWindowsOS環境でのエージェント能力を評価する『WindowsAgentArena』およびエージェント『Navi（ナビ）』Microsoftが開発](https://ai-data-base.com/archives/75765)

## 背景

人工知能の分野において、”自律的に計画を立てる能力”を獲得することは長年の目標でした。”自律的に計画を立てる能力”とはすなわち、ゴールを達成するために必要な行動の順序を決定する能力のことです。

この目標に向けて、これまでは特定のタスクに特化したシステムを作ることに焦点が当てられてきました。その結果、ある分野では正確な解決策を提供できるものの、汎用性に欠けたシステムが出来上がってきました。

そんな中、LLMの登場で状況が変わってきました。LLMエージェントは従来と比較にならないほど様々な計画タスクに対応できる可能性があるのです。

ただし、それでも人間レベルの計画能力にはまだ及びません。例えば、最新のモデルでも、複雑な現実世界の計画ベンチマークで15.6%の成功率しか達成できていません。

今回研究者らは、現在のLLMエージェントがなぜ計画タスクで苦戦しているのかを明らかにしようとしています。また、エージェントの計画能力を向上させるための戦略を提案しています。  
そこで、計画の2つの重要な要素である「制約」と「質問」に注目しました。

以下で研究内容とその結果を詳しく紹介します。

![](https://ai-data-base.com/wp-content/uploads/2024/10/AIDB_77302_1.png)

エージェントの記憶更新戦略を示す図。直接プロンプト、パラメトリック記憶更新、エピソード記憶更新の3つの方法が示されており、以前の試行から得た洞察が活用されている。

## 本研究で使用されたデータセットと分析方法

この研究では、言語エージェントの計画立案能力を調べるために2つの異なるタイプのデータセットが使われました。

### BlocksWorld（ブロックワールド）

単純化された環境でのパズルのようなタスクのデータセットです。

エージェントは、ブロックを動かして特定の配置を作ります。タスクの説明には、どのような行動が可能か、どのような制約があるかが明確に書かれています。与えられた初期状態から目標の状態になるよう、ブロックを動かす計画を立てる必要があります。

### TravelPlanner（旅行プランナー）

こちらは現実世界の旅行計画を立てるタスクのデータセットです。

エージェントは、与えられた情報とユーザーの要望に基づいて旅行計画を作成します。計画は一般的な常識に沿っていなければならず、また要望に含まれる厳しい制約条件も満たす必要があります。BlocksWorldと違い、TravelPlannerの制約条件は固定されていません。ユーザーの要望から制約を読み取り、それに合わせて計画を立てる必要があります。

なお、この研究では、エージェントの純粋な計画立案能力を見るため、外部ツールの使用は認められませんでした。

### 分析方法

システム内のどの要素が結果に大きな影響を与えているかを調べるために「置換特徴重要度（Permutation Feature Importance）」という分析方法が使用されました、

基本的な考え方として、ある要素が重要であれば、それを変更または削除したときにシステムの出力が大きく変わります。逆に、重要でない要素を変更しても出力はあまり変わりません。今回はこの方法を使って言語エージェントの計画立案過程が分析されています。

## 実験設定

研究チームは、モデルの学習と評価のためにデータを以下のように分けました。

1. BlocksWorld
	- 訓練用データ：100個のサンプル
	- 検証用データ：500個のサンプル
	- これらはランダムに選ばれました
2. TravelPlanner
	- 訓練用データ：45個のサンプル
	- 検証用データ：180個のサンプル
	- 元々のデータセットの分割を使用しました

訓練用データを使ってモデルを改善し、検証用データでその効果を確認するという流れです。

（ただし、計算コストが高いため、BlocksWorldの一部の分析では200個のサンプルをランダムに選んで使用しています）

### エピソード記憶の更新

エージェントの能力を高める方法として、過去の経験から学ぶ方法3つが試されました。

（１）行動のコピー  
失敗した計画と正解の計画を見せて学習させる方法

（２）オラクルフィードバック  
失敗した計画と、なぜ失敗したかの説明を与えて学習させる方法

（３）人間が書いた参考情報  
制約条件や常識についての要約を人間が作成し、それを使って学習させる方法

### パラメトリック記憶の更新

モデル自体を微調整する方法も試されました。訓練用データセットの正解を使って、モデルのパラメータを更新します。この過程は、8台のA100 [GPU](https://ai-data-base.com/archives/26570 "GPU") を使用して行われました。

なおOpenAIのモデルについては公式のスクリプトが使用され、オープンソースのモデルについては独自の設定が使用されました。

### 特徴の重要度の計算

実験結果の分析は、計画の中の重要な単語だけに注目して行われました。

BlocksWorldでは、「Pick Up」や「Put Down」などの動作と、「赤いブロック」のような対象物が分析されました。TravelPlannerでは、JSON形式で提供された情報の値の部分が分析されました。

## 実験結果

研究チームは、現在のLLMエージェントが計画立案タスクで苦戦していることを発見しました。例えばBlocksWorldタスクでは、ほとんどのエージェントが半分以下のタスクしか完了できませんでした。より複雑な現実世界のタスクであるTravelPlannerでは、成績はさらに悪く、最高性能のOpenAI o1モデルでさえ、20%未満の成功率でした。

![](https://ai-data-base.com/wp-content/uploads/2024/10/AIDB_77302_2-1024x340.png)

BlocksWorldとTravelPlannerの2つのベンチマークにおける9つのモデルの性能を示すグラフ。直接プロンプト、行動クローニング、オラクルフィードバック、参照、微調整の5つの戦略での結果が比較されている。

### 問題の原因

研究チームは、この問題の原因を探るため、計画立案の核心となる2つの要素に注目しました。それは、

1. 制約条件の扱い
2. 質問（目標）の影響

です。

### 制約条件は機能しているか？

制約条件は計画立案において重要な要素ですが、研究の結果、エージェントはこれをうまく扱えていないことが分かりました。

まず、制約条件の重要度スコアが低いことが判明しました。エージェントが計画を立てる際に、与えられた制約条件をほとんど考慮していないことを意味します。例えば、「ブロックは一度に1つしか動かせない」という制約があっても、エージェントはその情報をあまり重視せずに計画を立てているようです。

![](https://ai-data-base.com/wp-content/uploads/2024/10/AIDB_77302_3-1024x327.png)

異なるエージェントにおける制約とエピソード記憶コンポーネントの最終計画に対する帰属スコアを示すグラフ。エピソード記憶更新の効果も示されている。

次に、エージェントは制約条件を正確に参照できていないことが分かりました。BlocksWorldタスクで「Pick Up（持ち上げる）」という行動を行う際、エージェントは関連するすべての制約条件を考慮すべきですが、そうなっていません。例えば、「ブロックを持ち上げるには、そのブロックの上に何も乗っていない状態でなければならない」という制約があっても、エージェントはその条件を常に確認せずに行動を選択している可能性があります。

![](https://ai-data-base.com/wp-content/uploads/2024/10/AIDB_77302_4.png)

Llama3.1-70BモデルのBlocksWorldにおける、アクションと制約の記述に対する最終計画中のアクションの帰属スコア分布を示す図。

さらに驚くべきことに、一部のモデルでは、制約条件を与えない方が良い結果を出すこともありました。制約条件がエージェントの思考を混乱させている可能性を示唆しています。つまり、制約条件を提示することで、かえってエージェントが適切な計画を立てることを難しくしているのかもしれません。

![](https://ai-data-base.com/wp-content/uploads/2024/10/AIDB_77302_5.png)

BlocksWorldにおいて、プロンプトに制約の記述がある場合とない場合の性能比較を示す表。

人間の場合、制約条件があることで問題解決がより明確になることが多いですが、それとは対照的です。

### 質問（目標）の影響力の低下

計画が長くなるほど、質問（つまり、達成すべき目標）の影響力が低下することも分かりました。

まず、計画のステップ数が増えるほど、エージェントの性能が低下することが分かりました。例えば、3ステップの計画では高い成功率を示したエージェントが、10ステップの計画になると著しく成功率が下がるといった具合です。これは、エージェントが長期的な計画を立てることに苦戦していることを示しています。

![](https://ai-data-base.com/wp-content/uploads/2024/10/AIDB_77302_6-1024x618.png)

計画の長さが増加するにつれての性能比較を示すグラフ。上部は異なるエージェントの性能を、下部は計画の長さが延びるにつれての質問の帰属スコアを示している。

そしてさらに詳細な分析の結果、計画の後半になるほど、質問（目標）の影響力が弱まっていることが判明しました。つまり、エージェントは計画の初期段階では目標をよく考慮していますが、計画が進むにつれてその目標を見失っていく傾向があるのです。例えば、旅行計画を立てる際、最初は目的地や予算をしっかり考慮していても、細かい日程を組み立てていく中で、それらの重要な条件を忘れてしまうようなことが起きているのです。

以上から、エージェントが計画を進めるうちに本来の目標を見失っていく傾向があると解釈されています。人間であれば、計画の各段階で常に最終目標を確認しながら進めますが、現在のLLMエージェントにはその能力が十分に備わっていないようです。「目標を常に意識し続ける」という、人間にとっては当たり前の能力の獲得は、まだAIにとっては難しい課題なのかもしれません。

## メモリを更新するとLLMエージェントに何が起こるか

次に、LLMエージェントの性能を向上させるためにエピソード記憶の更新とパラメトリック記憶の更新が試されました。

### エピソード記憶の更新

詳細は前述のとおりですが、エピソード記憶の更新は、制約条件や常識的な情報を整理して、エージェントに再提示する方法です。

研究の結果、以下のことが分かりました。

まず、単に情報を繰り返すだけでも、エージェントの性能が向上しました。例えば、TravelPlannerタスクでは「安い商品を選ぶ」といった洞察を提供すると、エージェントの性能が上がりました。BlocksWorldタスクでも、制約条件を少し言い換えたり強調したりするだけで効果がありました。

![](https://ai-data-base.com/wp-content/uploads/2024/10/AIDB_77302_7-1024x281.png)

Llama3.1-70BのBlocksWorldとTravelPlannerにおける、エピソード記憶の最終計画に対する帰属スコアを示す図。横軸は制約、縦軸は計画中の対応するアクションまたはアイテムを示している。

次に、漠然とした情報よりも、具体的で明確な制約条件の方がエージェントにとって使いやすいようです。例えば、「手が空いていないときは’Pick Up’できない」という明確な制約の方が、「安い商品を選ぶ」という一般的なアドバイスよりも効果的でした。

そして、エージェントは提供された情報を全体的には理解できるようになりましたが、それを細かい状況に適切に当てはめることはまだ難しいようです。例えば、TravelPlannerタスクで宿泊施設を選ぶ際、関連する制約条件をすべて正確に考慮することはできていませんでした。

### パラメトリック記憶の更新

パラメトリック記憶の更新（モデル自体の微調整）も性能向上が見られました。その理由を探るため、研究チームは質問（目標）の影響力に注目しました。

その結果、更新後、エージェントは質問（つまり目標）をより強く意識しながら計画を立てられるようになることが分かりました。

そして質問の影響力は確かに向上しましたが、計画が長くなるにつれてその影響力は依然として弱まっていきました。つまり、長期的な目標を維持しながら計画を立てることは、まだエージェントにとって難しい課題であることが分かりました。

### 両方の組み合わせ

研究チームは、これら2つの方法を組み合わせることで更なる改善が見られるかも調べました。しかし意外なことに、両方を組み合わせても効果はなく、むしろ性能が低下することもありました。

![](https://ai-data-base.com/wp-content/uploads/2024/10/AIDB_77302_8.png)

BlocksWorldにおける2つの微調整済みモデルのエピソード記憶更新ありとなしの比較を示す表。

そしてこれらは「近道」を学習するようなものであり、動的な問題解決よりも静的なルールの学習に偏っていることも分かりました。例えば、TravelPlannerタスクでは常識的なルールは学べましたが、複雑な制約条件を扱うような高度な能力の向上には至りませんでした。

![](https://ai-data-base.com/wp-content/uploads/2024/10/AIDB_77302_9.png)

BlocksWorldにおける2つの微調整済みエージェントの制約とエピソード記憶の帰属スコアを示す図。

![](https://ai-data-base.com/wp-content/uploads/2024/10/AIDB_77302_10.png)

TravelPlannerにおける異なるエージェントの性能比較を示す表。直接プロンプト、エピソード記憶更新、パラメトリック記憶更新の3つの戦略での結果が示されています。

## まとめ

本記事では、言語エージェントの計画タスクにおける課題を調査した研究を紹介しました。研究者たちは、制約と質問の役割に注目し、制約の影響が小さいこと、計画の長期化に伴い質問の影響力が弱まることを発見しました。エピソード記憶とパラメトリック記憶の更新戦略が一定の改善をもたらすものの、根本的な解決には至っていません。この研究は、言語エージェントが人間レベルの知能を達成するための課題を明らかにし、今後の研究の方向性を示唆しています。

- 参照論文URL： [https://arxiv.org/abs/2410.12409](https://arxiv.org/abs/2410.12409)

**■サポートのお願い  
**AIDBを便利だと思っていただけた方に、任意の金額でサポートしていただけますと幸いです。  

  

[500以上の実世界のマルチモーダルタスクを含む、過去最大規模の評価ベンチマーク『MEGA-BENCH』登場](https://ai-data-base.com/archives/74837)

[IBMから日本語対応の商用可能オープンソースLLM「GRANITE 3.0」公開　8Bから](https://ai-data-base.com/archives/77349)

 [![](https://ai-data-base.com/wp-content/themes/innovate_hack_tcd025/img/footer/return_top.png) PAGE TOP](https://ai-data-base.com/archives/#header_top)