---
title: "マルチモーダルLLM活用で画像異常検知に「意味」を与え精度向上 見つけるだけで終わらせない"
source: "https://ai-data-base.com/archives/89515"
author:
  - "[[AIDB Research]]"
published: 2025-05-15
created: 2025-06-13
description: "本記事では、視覚モデルとマルチモーダルLLMを組み合わせて異常を分類する手法を紹介します。従来の異常検出では見落とされがちだった「異常の中身」に踏み込み、対応判断まで視野に入れた設計が特徴です。"
tags:
  - "clippings"
---
**【お知らせ】** AIDB主催のビジネスマッチングイベントを7月25日(金)開催予定です！  
  

\---以下、記事本文---

本記事では、視覚モデルとマルチモーダルLLMを組み合わせて異常を分類する手法を紹介します。

従来の異常検出では見落とされがちだった「異常の中身」に踏み込み、対応判断まで視野に入れた設計が特徴です。検出器とLLMを段階的に連携させることで、精度と解釈性の両立を図っています。

異常対応の現場において、どの情報をどの順で渡すかを再考するきっかけにもなりそうです。

![](https://ai-data-base.com/wp-content/uploads/2025/05/AIDB_89515-1024x576.png)

## 見つけるだけでは足りない　異常に「意味」を与えることの重要性

異常をどう扱うかは、製造業に限らず多くの分野で日々直面する課題です。AIによって外れ値を検出する技術はすでに普及しつつありますが、「見つける」ことがゴールではありません。

実際には、その異常がどのような意味を持つのかを見極め、それにどう対応すべきかを判断する力が求められます。ここに、検出にとどまらない「分類」の重要性があります。

たとえば、外観検査においてワイヤーの曲がりは簡単な調整で済むかもしれませんが、パーツの欠落は工程全体を見直す必要があるかもしれません。また、色味の違いがただの仕様変更だった場合、それを誤って不良品と判定すれば、無駄な再作業や廃棄が発生します。  
こうした判断の多くは、従来は人が担ってきました。

現在の異常検出システムは、視覚的なズレをもとに「正常ではない」と判断しますが、実際には問題のないケースも多く含まれます。しかも、その「正常」も過去のデータに基づくものであり、意味や文脈は考慮されません。AIが出す結果に対して、現場が「これは対応すべき異常なのか、それとも無視していいのか」と迷う状況は、今も少なくありません。

こうした状況に対して、視覚情報だけでなく言語的な指示や説明を組み合わせて異常の意味を理解するしくみが注目を集めています。人が「これはこういう異常だから、この程度なら許容範囲」と判断するように、AIにも意味ベースの処理を担わせようという動きです。

そうした「異常の意味を分類する」ことに焦点を当て、マルチモーダルLLMを活用した新たな枠組みと評価方法が提案されています。製造業にとどまらず、医療、交通、インフラ、サポート業務など、何が通常で何が問題なのかを見極める力が求められるあらゆる場面において、柔軟なAI活用のヒントを与えてくれます。

以下で詳しく紹介します。

![](https://ai-data-base.com/wp-content/uploads/2025/05/AIDB_89515_1-1024x637.png)

本手法の使用例

## これまでの流れ

### 異常検出は進化してきたが限界がある

産業分野で広く使われている異常検出の手法は、画像の差異をもとにした高速かつ高精度なアプローチが主流となっています。ただし、異常の「意味」や「対応の要否」までは判断できません。

ResNetなどを使って正常データの特徴を抽出し、そこから外れたものを異常とみなす手法です。あらかじめ決められた正常の範囲に合わないかどうかが判断軸になります。

画像を生成・再構成することで、「どれだけ忠実に再現できるか」を異常度として評価する手法です。拡散モデルなどの進歩により精度も高まり、実用が現実味を帯びています。

### 意味の理解が求められている

画像処理だけでは見えてこない「これはどういう異常か」「対応すべきか」を判断するために、LLMやマルチモーダルの活用が模索されはじめています。

LLMを使った異常検出は登場していますが、多くは「異常があるかどうか」にとどまり、「何が起きているのか」の分類や解釈までは踏み込んでいません。

既存のアプローチでは、人の入力や限定的な検出器に頼る場面も多く、運用面では課題が残ります。そのなかで、画像処理の強みとLLMの意味理解を組み合わせる発想が注目されています。

![](https://ai-data-base.com/wp-content/uploads/2025/05/AIDB_89515_2-1024x607.png)

## 異常を分類するために「見つけ方」を工夫

異常を分類するためには、まず正確に異常を検出し、その上で「これはどのタイプか」を理解する仕組みが欠かせません。そこで今回、「異常を検出する目」と「意味を読み取る頭脳」を分担させた、2段構成のフレームワークが提案されいます。

画像ベースの検出モデル（ビジョンエキスパート）と、マルチモーダルLLMを組み合わせるものです。先に専用の検出器で「異常があるかどうか」を絞り込み、異常と判定された画像だけをLLMに渡すことで、効率と精度の両方を確保します。

単に「変な画像がある」と報告するだけでなく、「どこがどうおかしいのか」を柔軟に言語化し、分類まで導く方法です。

![](https://ai-data-base.com/wp-content/uploads/2025/05/AIDB_89515_3-1024x428.png)

本手法の全体の流れ

### ステップ１：「ビジョンエキスパート」が異常の検出と絞り込みを行う

異常が含まれているかどうかを素早く見分け、さらに画像の中のどこに異常があるのかをピクセル単位で特定します。次の2つの役割が重要です。

#### 1\. 異常の検出と局所化を高速に処理

まず、あらゆる画像をすべてLLMに渡すのではなく、最初に「正常か異常か」を判断する専用の検出器を使ってフィルタリングします。正常と明らかに判断できるものはここで処理が完了し、LLMに渡す必要はありません。

こうすることで、計算コストを抑えつつ、LLMの判断を必要とする「グレーなケース」にだけ注力できます。加えて、異常の場所が特定できることで、後段のモデルが「どこに注目すべきか」を視覚的に理解しやすくなります。

#### 2\. 「赤枠」で異常箇所を明示するビジュアルプロンプト

異常箇所は赤い輪郭で囲んでLLMに渡します。これでモデルは「どこが問題なのか」を認識したうえで分類タスクに取り組むことができます。構造化された入力によって、モデルの注目点を明確にし、無駄な誤解やばらつきを防ぐことができます。

実験では、DDADという高速な異常検出モデルを使用しています。1枚あたり35ミリ秒で処理でき、LLMと比較して大幅に高速です。リアルタイム性が求められる現場でも十分使える処理スピードです。

（LLMの前段階でどのような異常現出モデルを使用するかはプロジェクトによって異なります）

### ステップ2：「異常をどう分類するか」をLLMが担う

異常と判定された画像については、その異常が「どのタイプに該当するか」をLLMが判断します。ここで注目すべきは、事前に固定された分類ラベルだけでなく、用途に応じてユーザー側が分類基準を定義できるという点です。

たとえば、「ヒビがあるかどうか」だけでなく、「ヒビがどこにあるか」「どの程度の深さか」「修理が必要なレベルか」といった観点を含めます。

#### 構造化プロンプトで分類方針を明示する

LLMに任せきりにするのではなく、プロンプトの中に分類のルールや前提条件を明確に書き込むことが重要です。次の3点を含むプロンプト構成が推奨されています。

**（１）正常な状態の説明  
**モデルにとって「どこまでが正常なのか」の基準がなければ、異常の意味も判断できません。形状や色、質感など、正常時の特徴をあらかじめ説明文として与えます。

**（２）異常クラスの定義  
**たとえば「broken\_large」「broken\_small」などのように、分類ラベルの違いをどう判断するかを文章で記述します。あいまいな単語（たとえば「ヒビ」）が複数の意味を持ち得る場合は、例や基準を併記します。

**（３）分類戦略（どこを見るか）  
**「注目すべき部位はどこか」「大きさの閾値はどれくらいか」など、分類に必要な観点を明示します。LLMが画像から得られる情報を意味に沿って解釈できるようにするためです。

このように、人が自然に行っている「判断の根拠」を言語化してプロンプトに盛り込むことで、LLMは一貫性と柔軟性を両立した分類を行うようになります。

![](https://ai-data-base.com/wp-content/uploads/2025/05/AIDB_89515_4-1024x595.png)

### 精度の高い分類には、データの整備も不可欠

[分類器](https://ai-data-base.com/archives/26489 "分類器") がうまく機能するかどうかは、分類の基準だけでなく、その基準が正しく反映されたデータで検証されているかどうかにも大きく依存します。

ところが既存の異常検出データセット（例：MVTec-AD）は、多くが「異常の有無」や「位置」にしか注目しておらず、「どのタイプの異常か」があいまいなものも少なくありません。

![](https://ai-data-base.com/wp-content/uploads/2025/05/AIDB_89515_5-1024x665.png)

MVTec-ADにおける“bent”と“broken”の判定例。見た目が似ており、誤分類されていたサンプルが多数存在していた

![](https://ai-data-base.com/wp-content/uploads/2025/05/AIDB_89515_6-1024x646.png)

ジッパーにおける“broken\_teeth”と“rough”のサンプル。視覚的には非常に似ており、分類の曖昧さを引き起こしていたことがわかる

そのためこの研究では、評価の土台となるデータセット自体も丁寧に整備し直しています。

#### MVTec-AC（分類に耐えうるよう既存の誤りを修正したもの）

・異常クラスのラベル付けミス（36件）を修正  
・似たクラスが重複していた場合（たとえば「poke」と「crack」など）を統合  
・分類評価に意味を持たない「combined」などの不明瞭クラスを除外

つまり「何をもって分類すべきか」が明確に示されたデータセットが構築されました。

#### VisA-AC（少数サンプルの扱いや定義のあいまいさに配慮）

・10件未満しか存在しないクラスは削除  
・類似した異常タイプは統合し、意味的な差異があるものだけを残す  
・人手でラベルミスを見直し、分類評価に支障が出ないよう調整

### 実際には、組み合わせる視覚モデルとLLMは選ぶ

異常で紹介した [アーキテクチャ](https://ai-data-base.com/archives/26562 "アーキテクチャ") は「構成の考え方」であり、DDADやGPT-4oに限らず、用途やリソースに応じて別の視覚モデルやLLMと組み合わせます。

たとえば、「軽量な推論を行いたい」場合には、推論時間の短いビジョンモデルやLLMを選びますし、「分類ルールが頻繁に変わる」現場であれば、プロンプトを書き換えるだけで柔軟に運用できます。

要は、「異常の検出」と「意味の理解・分類」というタスクを分業して、それぞれに適したモデルを組み合わせるのがポイントです。

## 現場に応用できるのか？性能検証実験

どんなに仕組みが巧妙でも、現場で活用できるかどうかは実際の性能によって決まります。上述した方法論がどれだけ確かな分類を行えるかを、多角的な評価指標とベンチマークを使って検証しています。

### どんな指標で性能を測るべきか

異常分類では、ただ単に「当たった数」を見るだけでは不十分です。対象となる異常の種類が不均等であったり、偶然の一致が起きる可能性もあるため、より精度の高い指標が求められます。

#### すべての異常タイプを同じ重みで評価するマクロ精度

異常の種類ごとに予測の正確さを評価し、それを平均して全体の精度を出す指標です。どのクラスにも等しく配慮することで、「頻度の高い異常ばかり正解していた」という偏りを抑えます。

#### 見落としと誤検出のバランスを見るマクロF1スコア

[F1スコア](https://ai-data-base.com/archives/26112 "F1スコア（F値）") は「どれだけ正しく当てられたか」に加え、「誤って当てていないか」も加味します。これを異常の種類ごとに計算して平均を取ることで、モデルの安定性や偏りへの強さが見えてきます。

#### 「偶然当たっただけ」を差し引いて評価するコーエンのカッパ

現実のデータでは、たまたま当たってしまうケースもあります。カッパ係数は、そうした偶然による一致を取り除いたうえで「どれだけ本質的に正しい分類ができたか」を測る指標です。

こうした3つの軸で評価することで、単なる当たり外れではなく、モデルがどれだけ確信をもって意味のある判断をしているかが明らかになります。

### 実験環境と入力構成

すべての実験では、LLMに渡す入力画像の解像度を448×448ピクセルに統一し、推論のブレを防ぐため温度（生成のランダム性）はゼロに設定しました。

入力には以下の4つをセットで与えます。

- 通常時の参照画像（同カテゴリの正常サンプル）
- 問題のある画像（分類対象）
- 赤線で異常箇所を示した画像（視覚的注目を促す）
- 分類ルールや説明を含むテキストプロンプト

この構成は、LLMにとって「何が正常で、どこが問題で、どう判断すべきか」を理解させるための最低限のセットです。

### まずは従来の評価基準でも比較

従来の異常検出研究でも使われてきたMVTec-ADで評価したところ、本手法は81.4%の分類精度を記録し、既存の代表的手法を上回りました。

| 手法名 | モデルの種類 | 異常分類精度（%） |
| --- | --- | --- |
| Echo | LLMベース | 72.9 |
| MCAD | 画像ベース | 76.4 |
| VELM | 本手法（LLM＋画像） | **81.4** |

「意味に基づいて異常を分類する」という設計方針が、既存の画像処理だけに頼った手法よりも高い判断力につながることを示唆しています。

### 精度の底力を引き出すにはデータ整備も不可欠

ラベルの不一致や曖昧なクラスを整理した改訂版データセット（MVTec-AC）で評価すると、本手法の本領がさらに発揮されます。

最も理想的な環境（正解の異常位置を前提とした“オラクル条件”）では、87.8%の分類精度を記録しました。

しかし、実際の現場では完全な異常検出器は存在しません。そこで、以下のような構成でも評価を行いました。

| 構成 | 分類精度 |
| --- | --- |
| DDAD + GPT-4o（標準） | 84.0% |
| PatchCore + GPT-4o（別の検出器） | 78.1% |
| DDAD + GPT-4o-mini（軽量LLM） | 75.7% |

この結果から、異常の局所化が正確であるほど、分類精度が大きく伸びることがわかります。逆に、局所化がずれるとLLMも誤った判断を下しやすくなるため、異常検出器の精度が分類の土台を支えていることが見えてきます。

結果全体は以下の通りです。

![](https://ai-data-base.com/wp-content/uploads/2025/05/AIDB_89515_8-1024x540.png)

### より現場に近い条件で試す

さらに多様な対象を含むVisA-ACデータセットでもVELMの性能を検証しました。こちらは部品だけでなく、食品や回路基板など、より現場に近いカテゴリが多数含まれているため、汎用性を試すにはうってつけです。

オラクル条件（正解の異常位置が与えられている状態）では、87.6%の分類精度を達成しました。これは、前段の異常検出さえ正確なら、LLMによる分類は安定して高い性能を出せることを示しています。

ただし、異常検出器をDDADやPatchCoreといった現実的なモデルに置き換えると、性能はやや低下します。

| 構成 | 分類精度 |
| --- | --- |
| DDAD + GPT-4o | 69.6% |
| PatchCore + GPT-4o | 68.5% |
| DDAD + GPT-4o-mini | 63.5% |

これは、局所化マスクが不正確だったり、異常範囲が過剰に広いといったノイズが、LLMの判断を鈍らせてしまうためです。つまり、LLMの分類能力は「どこを注目するか」が明確であるほど強く発揮されるという特性が見えてきます。

詳しい結果一覧は以下の表のとおりです。

![](https://ai-data-base.com/wp-content/uploads/2025/05/AIDB_89515_9-1024x469.png)

### 「異常」と「欠陥」を区別できるか

製造現場で異常が検出されたからといって、それがすべて「対処すべき問題」とは限りません。たとえば、表面の小さな凹みは許容できるけれど、構造に影響する割れは重大な欠陥とみなされます。

本手法がこうした判断をどこまでできるのかを試すため、異常の一部を「軽微な逸脱（≒無視できる異常）」と見なす条件で分類実験が行われました。

各カテゴリで異常クラスの30%を「軽微」としてマークし、これを他の重大な欠陥や正常なサンプルと区別できるかを評価しました。この試行を5回ランダムに繰り返した結果、本手法は平均89.8%の精度でこの3分類（正常／軽微な異常／欠陥）を達成しました。

これは、LLMが「異常の重大さ」や「修正の要否」といった判断にも対応できる可能性を示しており、将来的には品質管理の判断支援ツールとしての活用も視野に入る結果です。

![](https://ai-data-base.com/wp-content/uploads/2025/05/AIDB_89515_10.png)

3クラス分類（正常／異常／欠陥）のカテゴリ別精度。カテゴリごとの精度と総合スコア（Total）を示す

### プロンプト設計はどこまで影響するか

LLMの性能を最大限引き出すには、「何を、どう伝えるか」が重要になります。そこで、プロンプトの中に含まれる要素をひとつずつ削除して分類精度がどう変わるかを検証しました。

テストしたのは以下の5要素です。

| 略語 | 要素名 | 内容の説明 |
| --- | --- | --- |
| RI | 参照画像 | 正常なサンプル画像を提示し、異常との比較を可能にする |
| VP | ビジュアルプロンプト | 異常箇所を赤線で囲み、LLMに注目すべき領域を示す |
| ND | 正常オブジェクトの説明 | 通常時の形状・色・特徴を文章で明示し、基準を与える |
| AD | 異常クラスの説明 | 分類対象となる異常の意味や違いを具体的に説明する |
| CS | 分類戦略 | どの特徴を重視するかなど、分類の指針をLLMに伝える |

結果は明確で、いずれかの要素を省くと精度が確実に下がることがわかりました。

| 省いた要素 | 分類精度（%） |
| --- | --- |
| なし（完全プロンプト） | 84.0 |
| RIなし | 81.6 |
| VPなし | 82.6 |
| NDなし | 83.5 |
| CSなし | 82.6 |
| ADなし | 78.6（最も大きく低下） |

とくに異常クラスの説明（AD）を抜いた場合、分類精度は大きく低下しました。これは、LLMが「何をもって分類すべきか」の文脈を失うと、一貫性のある判断が難しくなることを意味します。

逆にいえば、構造化されたプロンプトを通じて人間の分類基準を明示すれば、LLMは非常に高精度な分類を行えるということでもあります。

このアブレーション実験における結果詳細も以下に示します。

![](https://ai-data-base.com/wp-content/uploads/2025/05/AIDB_89515_11-1024x507.png)

## まとめ

本記事では、異常分類に特化したマルチモーダルフレームワークを紹介しました。

視覚モデルとLLMを段階的に組み合わせることで、柔軟な分類と高い解釈性を両立しています。検出精度だけでなく、異常の意味的な違いを踏まえた対応判断まで踏み込める点が特徴です。

実験では既存手法よりも高い分類精度を示し、プロンプト設計の影響も定量的に検証されました。

異常の扱い方が業務成果につながるような場面で、自社の判断ルールをLLMに落とし込むヒントになるかもしれません。

**参照文献情報**

- タイトル：Detect, Classify, Act: Categorizing Industrial Anomalies with Multi-Modal Large Language Models
- URL： [https://doi.org/10.48550/arXiv.2505.02626](https://doi.org/10.48550/arXiv.2505.02626)
- 著者：Sassan Mokhtar, Arian Mousakhan, Silvio Galesso, Jawad Tayyub, Thomas Brox
- 所属：University of Bonn, University of Freiburg, Endress + Hauser

**■サポートのお願い  
**AIDBを便利だと思っていただけた方に、任意の金額でサポートしていただけますと幸いです。  

  

[LLM活用アプリ開発事例　ユーザーの目標達成を支援する習慣化システムの作り方](https://ai-data-base.com/archives/89474)

[LLMによるフィードバック生成を一段階進める方法　学びを促進するための見直しと導入の手順](https://ai-data-base.com/archives/89588)

 [![](https://ai-data-base.com/wp-content/themes/innovate_hack_tcd025/img/footer/return_top.png) PAGE TOP](https://ai-data-base.com/archives/#header_top)